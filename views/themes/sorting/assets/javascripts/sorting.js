"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?t(require("jquery")):t(jQuery)}(function(c){var i=window.location,r="qor.sorting",t="enable."+r,o="change."+r,n="mousedown."+r,e="qor-sorting__highlight",p="qor-sorting__hover",l="tbody > tr",s=".qor-body__loading";function a(t,o){this.$element=c(t),this.options=c.extend({},a.DEFAULTS,c.isPlainObject(o)&&o),this.$source=null,this.ascending=!1,this.orderType=0,this.startY=0,this.init()}return a.prototype={constructor:a,init:function(){var n,i=this.options,t=this.$element,o=t.find(l),r=0,e=0,s=0;c("body").addClass("qor-sorting"),t.find("tbody .qor-table__actions").append(a.TEMPLATE),o.each(function(t){var o=c(this).find(i.input).data("position");0<t&&(n<o?e++:e--),n=o,s=t}),e===s?r=1:-e===s&&(r=-1),this.$rows=o,this.orderType=r,this.bind()},bind:function(){var t=this.options;this.$element.on("click.qor.sorting",t.input,function(){return!1}).on(o,t.input,c.proxy(this.change,this)).on(n,t.toggle,c.proxy(this.mousedown,this)).on("mouseup.qor.sorting",c.proxy(this.mouseup,this)).on("dragstart.qor.sorting",l,c.proxy(this.dragstart,this)).on("dragend.qor.sorting",l,c.proxy(this.dragend,this)).on("dragover.qor.sorting",l,c.proxy(this.dragover,this)).on("drop.qor.sorting",l,c.proxy(this.drop,this))},unbind:function(){this.$element.off(o,this.change).off(n,this.mousedown)},change:function(t){var i,r=this.options,e=this.orderType,o=this.$rows,n=c(t.currentTarget),s=n.closest("tr"),a=s.parent(),d=n.data(),u=d.position,p=parseInt(n.val(),10),l=u<p;return t.stopPropagation(),o.each(function(){var t=c(this),o=t.find(r.input),n=o.data("position");n===p&&(i=t,l?1===e?i.after(s):-1===e&&i.before(s):1===e?i.before(s):-1===e&&i.after(s)),l?u<n&&n<=p&&o.data("position",--n).val(n):n<u&&p<=n&&o.data("position",++n).val(n)}),n.data("position",p),i||(l?1===e?a.append(s):-1===e&&a.prepend(s):1===e?a.prepend(s):-1===e&&a.append(s)),this.sort(s,{url:d.sortingUrl,from:u,to:p}),!1},mousedown:function(t){this.startY=t.pageY,c(t.currentTarget).closest("tr").prop("draggable",!0)},mouseup:function(){this.$element.find(l).prop("draggable",!1)},dragend:function(){c(l).removeClass(p),this.$element.find(l).prop("draggable",!1)},dragstart:function(t){var o=t.originalEvent,t=c(t.currentTarget);t.prop("draggable")&&o.dataTransfer&&(o.dataTransfer.effectAllowed="move",this.$source=t)},dragover:function(t){var o=this.$source;c(l).removeClass(p),c(t.currentTarget).prev("tr").addClass(p),o&&t.currentTarget!==this.$source[0]&&t.preventDefault()},drop:function(t){var o,n,i,r,e,s=this.options,a=this.orderType,d=t.pageY>this.startY,u=this.$source;c(l).removeClass(p),u&&t.currentTarget!==this.$source[0]&&(t.preventDefault(),n=c(t.currentTarget),t=(o=u.find(s.input)).data(),i=t.position,r=n.find(s.input).data("position"),e=i<r,this.$element.find(l).each(function(){var t=c(this).find(s.input),o=t.data("position");e?i<o&&o<=r&&t.data("position",--o).val(o):o<i&&r<=o&&t.data("position",++o).val(o)}),o.data("position",r).val(r),e?1===a||-1!==a&&d?n.after(u):n.before(u):1===a||-1!==a&&d?n.before(u):n.after(u),this.sort(u,{url:t.sortingUrl,from:i,to:r}))},addLoading:function(){c(s).remove(),c(a.TEMPLATE_LOADING).appendTo(c("body")).trigger("enable.qor.material")},sort:function(t,o){o.url&&(this.highlight(t),this.addLoading(),c.ajax(o.url,{method:"post",data:{from:o.from,to:o.to},success:function(t,o,n){n.status},error:function(t,o,n){422===t.status?window.alert(t.responseText):window.alert([o,n].join(": ")),i.reload()}}).always(function(){c(s).remove()}))},highlight:function(t){t.addClass(e),setTimeout(function(){t.removeClass(e)},2e3)},destroy:function(){this.unbind(),this.$element.removeData(r)}},a.DEFAULTS={toggle:!1,input:!1},a.TEMPLATE='<a class="qor-sorting__toggle"><i class="material-icons">drag_handle</i></a>',a.TEMPLATE_LOADING='<div class="qor-body__loading">\n                                        <div class="mdl-dialog-bg" style="opacity:.25;"></div>\n                                        <div><div class="mdl-spinner mdl-js-spinner is-active qor-layout__bottomsheet-spinner"></div></div>\n                                    </div>',a.plugin=function(i){return this.each(function(){var t,o=c(this),n=o.data(r);if(!n){if(/destroy/.test(i))return;o.data(r,n=new a(this,i))}"string"==typeof i&&c.isFunction(t=n[i])&&t.apply(n)})},c(function(){var o,n;/sorting\=true/.test(i.search)&&(o=".qor-js-table",n={toggle:".qor-sorting__toggle",input:".qor-sorting__position"},c(document).on("disable.qor.sorting",function(t){a.plugin.call(c(o,t.target),"destroy")}).on(t,function(t){a.plugin.call(c(o,t.target),n)}).trigger("disable.qor.slideout").triggerHandler(t))}),a});