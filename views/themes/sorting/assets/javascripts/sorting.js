"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?t(require("jquery")):t(jQuery)}(function(c){var t=window.location,r="qor.sorting",i="enable."+r,o="change."+r,n="mousedown."+r,e="qor-sorting__highlight",f="qor-sorting__hover",l="tbody > tr";function a(t,o){this.$element=c(t),this.options=c.extend({},a.DEFAULTS,c.isPlainObject(o)&&o),this.$source=null,this.ascending=!1,this.orderType=0,this.startY=0,this.init()}return a.prototype={constructor:a,init:function(){var n,i=this.options,t=this.$element,o=t.find(l),r=0,e=0,s=0;c("body").addClass("qor-sorting"),t.find("tbody .qor-table__actions").append(a.TEMPLATE),o.each(function(t){var o=c(this).find(i.input).data("position");0<t&&(n<o?e++:e--),n=o,s=t}),e===s?r=1:-e===s&&(r=-1),this.$rows=o,this.orderType=r,this.bind()},bind:function(){var t=this.options;this.$element.on("click.qor.sorting",t.input,function(){return!1}).on(o,t.input,c.proxy(this.change,this)).on(n,t.toggle,c.proxy(this.mousedown,this)).on("mouseup.qor.sorting",c.proxy(this.mouseup,this)).on("dragstart.qor.sorting",l,c.proxy(this.dragstart,this)).on("dragend.qor.sorting",l,c.proxy(this.dragend,this)).on("dragover.qor.sorting",l,c.proxy(this.dragover,this)).on("drop.qor.sorting",l,c.proxy(this.drop,this))},unbind:function(){this.$element.off(o,this.change).off(n,this.mousedown)},change:function(t){var i,r=this.options,e=this.orderType,o=this.$rows,n=c(t.currentTarget),s=n.closest("tr"),a=s.parent(),u=n.data(),d=u.position,p=parseInt(n.val(),10),f=d<p;return t.stopPropagation(),o.each(function(){var t=c(this),o=t.find(r.input),n=o.data("position");n===p&&(i=t,f?1===e?i.after(s):-1===e&&i.before(s):1===e?i.before(s):-1===e&&i.after(s)),f?d<n&&n<=p&&o.data("position",--n).val(n):n<d&&p<=n&&o.data("position",++n).val(n)}),n.data("position",p),i||(f?1===e?a.append(s):-1===e&&a.prepend(s):1===e?a.prepend(s):-1===e&&a.append(s)),this.sort(s,{url:u.sortingUrl,from:d,to:p}),!1},mousedown:function(t){this.startY=t.pageY,c(t.currentTarget).closest("tr").prop("draggable",!0)},mouseup:function(){this.$element.find(l).prop("draggable",!1)},dragend:function(){c(l).removeClass(f),this.$element.find(l).prop("draggable",!1)},dragstart:function(t){var o=t.originalEvent,n=c(t.currentTarget);n.prop("draggable")&&o.dataTransfer&&(o.dataTransfer.effectAllowed="move",this.$source=n)},dragover:function(t){var o=this.$source;c(l).removeClass(f),c(t.currentTarget).prev("tr").addClass(f),o&&t.currentTarget!==this.$source[0]&&t.preventDefault()},drop:function(t){var o,n,i,r,e,s,a=this.options,u=this.orderType,d=t.pageY>this.startY,p=this.$source;c(l).removeClass(f),p&&t.currentTarget!==this.$source[0]&&(t.preventDefault(),n=c(t.currentTarget),i=(o=p.find(a.input)).data(),r=i.position,e=n.find(a.input).data("position"),s=r<e,this.$element.find(l).each(function(){var t=c(this).find(a.input),o=t.data("position");s?r<o&&o<=e&&t.data("position",--o).val(o):o<r&&e<=o&&t.data("position",++o).val(o)}),o.data("position",e).val(e),s?1===u||-1!==u&&d?n.after(p):n.before(p):1===u||-1!==u&&d?n.before(p):n.after(p),this.sort(p,{url:i.sortingUrl,from:r,to:e}))},sort:function(i,t){var r=this.options;t.url&&(this.highlight(i),c.ajax(t.url,{method:"post",data:{from:t.from,to:t.to},success:function(t,o,n){200===n.status&&i.find(r.input).data("position",t).val(t)},error:function(t,o,n){422===t.status?window.alert(t.responseText):window.alert([o,n].join(": "))}}))},highlight:function(t){t.addClass(e),setTimeout(function(){t.removeClass(e)},2e3)},destroy:function(){this.unbind(),this.$element.removeData(r)}},a.DEFAULTS={toggle:!1,input:!1},a.TEMPLATE='<a class="qor-sorting__toggle"><i class="material-icons">drag_handle</i></a>',a.plugin=function(i){return this.each(function(){var t,o=c(this),n=o.data(r);if(!n){if(/destroy/.test(i))return;o.data(r,n=new a(this,i))}"string"==typeof i&&c.isFunction(t=n[i])&&t.apply(n)})},c(function(){var o,n;/sorting\=true/.test(t.search)&&(o=".qor-js-table",n={toggle:".qor-sorting__toggle",input:".qor-sorting__position"},c(document).on("disable.qor.sorting",function(t){a.plugin.call(c(o,t.target),"destroy")}).on(i,function(t){a.plugin.call(c(o,t.target),n)}).trigger("disable.qor.slideout").triggerHandler(i))}),a});