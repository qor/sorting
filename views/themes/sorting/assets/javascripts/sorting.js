"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?t(require("jquery")):t(jQuery)}(function(c){var t=window.location,e="qor.sorting",r="enable."+e,o="change."+e,n="mousedown."+e,i="qor-sorting__highlight",f="qor-sorting__hover",l="tbody > tr";function a(t,o){this.$element=c(t),this.options=c.extend({},a.DEFAULTS,c.isPlainObject(o)&&o),this.$source=null,this.ascending=!1,this.orderType=0,this.startY=0,this.init()}return a.prototype={constructor:a,init:function(){var n,r=this.options,t=this.$element,o=t.find(l),e=0,i=0,s=0;c("body").addClass("qor-sorting"),t.find("tbody .qor-table__actions").append(a.TEMPLATE),o.each(function(t){var o=c(this).find(r.input).data("position");0<t&&(n<o?i++:i--),n=o,s=t}),i===s?e=1:-i===s&&(e=-1),this.$rows=o,this.orderType=e,this.bind()},bind:function(){var t=this.options;this.$element.on("click.qor.sorting",t.input,function(){return!1}).on(o,t.input,c.proxy(this.change,this)).on(n,t.toggle,c.proxy(this.mousedown,this)).on("mouseup.qor.sorting",c.proxy(this.mouseup,this)).on("dragstart.qor.sorting",l,c.proxy(this.dragstart,this)).on("dragend.qor.sorting",l,c.proxy(this.dragend,this)).on("dragover.qor.sorting",l,c.proxy(this.dragover,this)).on("drop.qor.sorting",l,c.proxy(this.drop,this))},unbind:function(){this.$element.off(o,this.change).off(n,this.mousedown)},change:function(t){var r,e=this.options,i=this.orderType,o=this.$rows,n=c(t.currentTarget),s=n.closest("tr"),a=s.parent(),u=n.data(),d=u.position,p=parseInt(n.val(),10),f=d<p;return t.stopPropagation(),o.each(function(){var t=c(this),o=t.find(e.input),n=o.data("position");n===p&&(r=t,f?1===i?r.after(s):-1===i&&r.before(s):1===i?r.before(s):-1===i&&r.after(s)),f?d<n&&n<=p&&o.data("position",--n).val(n):n<d&&p<=n&&o.data("position",++n).val(n)}),n.data("position",p),r||(f?1===i?a.append(s):-1===i&&a.prepend(s):1===i?a.prepend(s):-1===i&&a.append(s)),this.sort(s,{url:u.sortingUrl,from:d,to:p}),!1},mousedown:function(t){this.startY=t.pageY,c(t.currentTarget).closest("tr").prop("draggable",!0)},mouseup:function(){this.$element.find(l).prop("draggable",!1)},dragend:function(){c(l).removeClass(f),this.$element.find(l).prop("draggable",!1)},dragstart:function(t){var o=t.originalEvent,n=c(t.currentTarget);n.prop("draggable")&&o.dataTransfer&&(o.dataTransfer.effectAllowed="move",this.$source=n)},dragover:function(t){var o=this.$source;c(l).removeClass(f),c(t.currentTarget).prev("tr").addClass(f),o&&t.currentTarget!==this.$source[0]&&t.preventDefault()},drop:function(t){var o,n,r,e,i,s,a=this.options,u=this.orderType,d=t.pageY>this.startY,p=this.$source;c(l).removeClass(f),p&&t.currentTarget!==this.$source[0]&&(t.preventDefault(),n=c(t.currentTarget),r=(o=p.find(a.input)).data(),e=r.position,i=n.find(a.input).data("position"),s=e<i,this.$element.find(l).each(function(){var t=c(this).find(a.input),o=t.data("position");s?e<o&&o<=i&&t.data("position",--o).val(o):o<e&&i<=o&&t.data("position",++o).val(o)}),o.data("position",i).val(i),s?1===u||-1!==u&&d?n.after(p):n.before(p):1===u||-1!==u&&d?n.before(p):n.after(p),this.sort(p,{url:r.sortingUrl,from:e,to:i}))},sort:function(t,o){o.url&&(this.highlight(t),c.ajax(o.url,{method:"post",data:{from:o.from,to:o.to},success:function(t,o,n){n.status},error:function(t,o,n){422===t.status?window.alert(t.responseText):window.alert([o,n].join(": "))}}))},highlight:function(t){t.addClass(i),setTimeout(function(){t.removeClass(i)},2e3)},destroy:function(){this.unbind(),this.$element.removeData(e)}},a.DEFAULTS={toggle:!1,input:!1},a.TEMPLATE='<a class="qor-sorting__toggle"><i class="material-icons">drag_handle</i></a>',a.plugin=function(r){return this.each(function(){var t,o=c(this),n=o.data(e);if(!n){if(/destroy/.test(r))return;o.data(e,n=new a(this,r))}"string"==typeof r&&c.isFunction(t=n[r])&&t.apply(n)})},c(function(){var o,n;/sorting\=true/.test(t.search)&&(o=".qor-js-table",n={toggle:".qor-sorting__toggle",input:".qor-sorting__position"},c(document).on("disable.qor.sorting",function(t){a.plugin.call(c(o,t.target),"destroy")}).on(r,function(t){a.plugin.call(c(o,t.target),n)}).trigger("disable.qor.slideout").triggerHandler(r))}),a});